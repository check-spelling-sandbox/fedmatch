<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tier Matching • fedmatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tier Matching">
<meta property="og:description" content="fedmatch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fedmatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.3.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Fuzzy-matching.html">Fuzzy Matching</a>
    </li>
    <li>
      <a href="../articles/Intro-to-fedmatch.html">Introduction to fedmatch</a>
    </li>
    <li>
      <a href="../articles/Multivar_matching.html">Multivar Matching</a>
    </li>
    <li>
      <a href="../articles/Using-clean-strings.html">Using clean_strings</a>
    </li>
    <li>
      <a href="../articles/Using-tier-match.html">Tier Matching</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Using-tier-match_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tier Matching</h1>
            
      
      
      <div class="hidden name"><code>Using-tier-match.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p><code>tier_match</code> is the ultimate wrapper function in <code>fedmatch.</code> <code>tier_match</code> puts together all of the pieces from the package into one function, letting the user perform many matches in one call. The function is excellent both as an exploratory tool, while the user is still figuring out how they want to execute their matches, and as a final matching tool that can be used in production code.</p>
<p>‘tiers’ of a match are useful because there are hierarchies of matches. An exact name match between two companies is a higher-quality match than a fuzzy match, and fuzzy matches with various levels of cleaning can be different levels of quality.</p>
</div>
<div id="syntax" class="section level1">
<h1 class="hasAnchor">
<a href="#syntax" class="anchor"></a>Syntax</h1>
<p>The syntax of <code>tier_match</code> is providing a core list of arguments to the function itself, and then passing a named list to the tier match. Each element in this list is itself a list, each of which is a tier to match on, and it contains all of the arguments necessary for that tier. All of these arguments will be passed to ‘merge_plus’ in sequence, and each of the matches from each tier are saved and combined.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tier_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  a <span class="op">=</span> <span class="fu"><a href="../reference/build_tier.html">build_tier</a></span><span class="op">(</span>match_type <span class="op">=</span> <span class="st">"exact"</span><span class="op">)</span>,
  b <span class="op">=</span> <span class="fu"><a href="../reference/build_tier.html">build_tier</a></span><span class="op">(</span>match_type <span class="op">=</span> <span class="st">"fuzzy"</span><span class="op">)</span>,
  c <span class="op">=</span> <span class="fu"><a href="../reference/build_tier.html">build_tier</a></span><span class="op">(</span>match_type <span class="op">=</span> <span class="st">"multivar"</span>, multivar_settings <span class="op">=</span> <span class="fu"><a href="../reference/build_multivar_settings.html">build_multivar_settings</a></span><span class="op">(</span>
    logit <span class="op">=</span> <span class="cn">NULL</span>, missing <span class="op">=</span> <span class="cn">FALSE</span>, wgts <span class="op">=</span> <span class="fl">1</span>,
    compare_type <span class="op">=</span> <span class="st">"stringdist"</span>, blocks <span class="op">=</span> <span class="cn">NULL</span>, blocks.x <span class="op">=</span> <span class="cn">NULL</span>, blocks.y <span class="op">=</span> <span class="cn">NULL</span>,
    top <span class="op">=</span> <span class="fl">1</span>, threshold <span class="op">=</span> <span class="cn">NULL</span>
  <span class="op">)</span><span class="op">)</span>

<span class="op">)</span>
<span class="co"># tier_list</span></code></pre></div>
<p>This list will perform three matches: ‘a’, an exact match; ‘b’, a fuzzy match, and ‘c’, a multivar match. We can get a bit fancier and add more settings to each, if we’d like. Remember that each element of each tier has to be an argument for <code>merge_plus</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tier_list_v2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  a <span class="op">=</span> <span class="fu"><a href="../reference/build_tier.html">build_tier</a></span><span class="op">(</span>match_type <span class="op">=</span> <span class="st">"exact"</span>, clean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
  b <span class="op">=</span> <span class="fu"><a href="../reference/build_tier.html">build_tier</a></span><span class="op">(</span>match_type <span class="op">=</span> <span class="st">"fuzzy"</span>, clean <span class="op">=</span> <span class="cn">TRUE</span>,
           fuzzy_settings <span class="op">=</span> <span class="fu"><a href="../reference/build_fuzzy_settings.html">build_fuzzy_settings</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"wgt_jaccard"</span>,
                                 maxDist <span class="op">=</span> <span class="fl">.7</span>,
                                 nthread <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
           clean_settings <span class="op">=</span> <span class="fu"><a href="../reference/build_clean_settings.html">build_clean_settings</a></span><span class="op">(</span>remove_words <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
  c <span class="op">=</span> <span class="fu"><a href="../reference/build_tier.html">build_tier</a></span><span class="op">(</span>match_type <span class="op">=</span> <span class="st">"multivar"</span>, 
                 multivar_settings <span class="op">=</span> <span class="fu"><a href="../reference/build_multivar_settings.html">build_multivar_settings</a></span><span class="op">(</span>
    logit <span class="op">=</span> <span class="cn">NULL</span>, missing <span class="op">=</span> <span class="cn">FALSE</span>, wgts <span class="op">=</span> <span class="fl">1</span>,
    compare_type <span class="op">=</span> <span class="st">"stringdist"</span>, blocks <span class="op">=</span> <span class="cn">NULL</span>, blocks.x <span class="op">=</span> <span class="cn">NULL</span>, blocks.y <span class="op">=</span> <span class="cn">NULL</span>,
    top <span class="op">=</span> <span class="fl">1</span>, threshold <span class="op">=</span> <span class="cn">NULL</span>
  <span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s take a look at the rest of the syntax for <code>tier_match</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tier_match.html">tier_match</a></span><span class="op">(</span><span class="va">corp_data1</span>, <span class="va">corp_data2</span>,
  by.x <span class="op">=</span> <span class="st">"Company"</span>, by.y <span class="op">=</span> <span class="st">"Name"</span>,
  unique_key_1 <span class="op">=</span> <span class="st">"unique_key_1"</span>, unique_key_2 <span class="op">=</span> <span class="st">"unique_key_2"</span>,
  tiers <span class="op">=</span> <span class="va">tier_list_v2</span>, takeout <span class="op">=</span> <span class="st">"neither"</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>,
  score_settings <span class="op">=</span> <span class="fu"><a href="../reference/build_score_settings.html">build_score_settings</a></span><span class="op">(</span>score_var_x <span class="op">=</span> <span class="st">"Company"</span>,
                                        score_var_y <span class="op">=</span> <span class="st">"Name"</span>,
                                        wgts <span class="op">=</span> <span class="fl">1</span>,
                                        score_type <span class="op">=</span> <span class="st">"stringdist"</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; Matching tier 'a'...</span>
<span class="co">#&gt; Time elapsed: 0.09 secs.</span>
<span class="co">#&gt; Matching tier 'b'...</span>
<span class="co">#&gt; Time elapsed: 0.04 secs.</span>
<span class="co">#&gt; Matching tier 'c'...</span>
<span class="co">#&gt; Time elapsed: 0.17 secs.</span></code></pre></div>
<p>There are two types of arguments for <code>tier_match</code>: those that can be passed to <code>merge_plus</code>, and those that are unique to <code>tier_match</code>. If anything of the <code>merge_plus</code> arguments are listed in <code>tier_match</code> directly (rather than in <code>tier_list</code>), those arguments are used in every tier. In this example, we are always matching on ‘Company’ and ‘Name,’ so those are placed in the arguments for tier_match directly. The arguments unique to <code>tier_match</code> and their defaults are:</p>
<ul>
<li>
<code>tiers</code> is the tier list create by iterations of <code><a href="../reference/build_tier.html">build_tier()</a></code>. Required, no default.</li>
<li>
<code>takeout</code> is a character vector, either “neither”, “both”, “data1”, or “data2”. These settings describe whether or not to take out matches in between each tier, and if so, what dataset to remove the matches for.</li>
<li>
<code>verbose</code> is a boolean. If <code>TRUE</code>, prints tier names and time taken to match each tier.</li>
</ul>
<p>The other arguments are all present in <code>merge_plus</code>, see documentation there for details.</p>
<p>The result for tier_match is a list with 4 items: the matched dataset, the unmatched data, and a match evaluation. Here’s what the matches look like:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span><span class="op">$</span><span class="va">matches</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>
<span class="co">#&gt;             Company Country State  SIC Revenue unique_key_1 country state_code</span>
<span class="co">#&gt; 1:          walmart     USA    OH 3300     485            1     USA         OH</span>
<span class="co">#&gt; 2:          walmart     USA    OH 3300     485            1     USA         OH</span>
<span class="co">#&gt; 3:          Walmart     USA    OH 3300     485            1     USA         OH</span>
<span class="co">#&gt; 4: Bershire Hataway     USA       2222     223            2     USA         NE</span>
<span class="co">#&gt; 5:            apple     USA    CA 3384     215            3     USA         CA</span>
<span class="co">#&gt;    SIC_code earnings unique_key_2              Name matchscore Company_score</span>
<span class="co">#&gt; 1:     3380  490,000            1           walmart  1.0000000     1.0000000</span>
<span class="co">#&gt; 2:     3380  490,000            1           walmart  1.0000000     1.0000000</span>
<span class="co">#&gt; 3:     3380  490,000            1           Walmart  1.0000000     1.0000000</span>
<span class="co">#&gt; 4:     2220  220,000            2 Bershire Hathaway  0.9882353     0.9882353</span>
<span class="co">#&gt; 5:       NA  220,000            3    apple computer  0.8714286     0.8714286</span>
<span class="co">#&gt;    tier wgt_jaccard_sim Company_compare multivar_score</span>
<span class="co">#&gt; 1:    a              NA              NA             NA</span>
<span class="co">#&gt; 2:    b       1.0000000              NA             NA</span>
<span class="co">#&gt; 3:    c              NA       1.0000000      1.0000000</span>
<span class="co">#&gt; 4:    c              NA       0.9882353      0.9882353</span>
<span class="co">#&gt; 5:    b       0.3333333              NA             NA</span></code></pre></div>
<p>As you can see, the matches dataset has a column called ‘tier’ that indicates which tier the match was from. It also adds any additional columns added by the matching process. In this example, we see ‘Company_score’, created from the from the post-hoc scoring; ‘wgt_jaccard_sim’, the Weighted Jaccard similarity, created when using the ‘wgt_jaccard’ setting of <code>fuzzy_match</code> (see the ‘Fuzzy-matching’ vignette for more details); and ‘Company_compare’, created from the multivar matching tier.</p>
<p>We also have a match evaluation, now filled out with more details broken down by tier:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span><span class="op">$</span><span class="va">match_evaluation</span>
<span class="co">#&gt;    tier matches in_tier_unique_1 in_tier_unique_2 pct_matched_1 pct_matched_2</span>
<span class="co">#&gt; 1:    a       2                2                2           0.2           0.2</span>
<span class="co">#&gt; 2:    b       7                7                7           0.7           0.7</span>
<span class="co">#&gt; 3:    c      10               10                9           1.0           0.9</span>
<span class="co">#&gt; 4:  all      19               10                9           1.0           0.9</span>
<span class="co">#&gt;    new_unique_1 new_unique_2</span>
<span class="co">#&gt; 1:            2            2</span>
<span class="co">#&gt; 2:            5            5</span>
<span class="co">#&gt; 3:            3            2</span>
<span class="co">#&gt; 4:           NA           NA</span></code></pre></div>
<p>We can use this evaluation to figure out which tiers did the ‘best’ job matching, getting the most unique matches.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Melanie Friedrichs, Chris Webster, Blake Marsh, Jacob Dice, Seung Lee.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
