<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multivar Matching • fedmatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multivar Matching">
<meta property="og:description" content="fedmatch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fedmatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Fuzzy-matching.html">Fuzzy Matching</a>
    </li>
    <li>
      <a href="../articles/Intro-to-fedmatch.html">Introduction to fedmatch</a>
    </li>
    <li>
      <a href="../articles/Multivar_matching.html">Multivar Matching</a>
    </li>
    <li>
      <a href="../articles/Using-clean-strings.html">Using clean_strings</a>
    </li>
    <li>
      <a href="../articles/Using-tier-match.html">Tier Matching</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Multivar_matching_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multivar Matching</h1>
                        <h4 class="author">Chris Webster</h4>
            
      
      
      <div class="hidden name"><code>Multivar_matching.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">fedmatch</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></code></pre></div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>While name matching is covered well by the tools in<code><a href="../reference/merge_plus.html">fedmatch::merge_plus()</a></code> and <code><a href="../reference/fuzzy_match.html">fedmatch::fuzzy_match()</a></code>, sometimes it is useful to pull in additional information besides names. These could include company information fields like industry code, zip codes, countries, and the like. Or, for loans, it could include loan amounts, origination dates, or industry codes. Or, one could even want to use multiple different names at the same time. This is where <code><a href="../reference/multivar_match.html">fedmatch::multivar_match()</a></code> comes into play. It lets you compare two records based on multiple fields. It does so by assigning a numeric value from 0-1 for each field, and then computing a weighted sum (or predicts a probability with a logit model), arriving at a final multivar_score for a given pair of records. It computes these multivar_scores for every possible combination of records, and picks the best match for each</p>
</div>
<div id="syntax" class="section level1">
<h1 class="hasAnchor">
<a href="#syntax" class="anchor"></a>Syntax</h1>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"corp_data1"</span>, package <span class="op">=</span> <span class="st">"fedmatch"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"corp_data2"</span>, package <span class="op">=</span> <span class="st">"fedmatch"</span><span class="op">)</span></code></pre></div>
<p>The basic syntax is as follows, using the example company data in fedmatch:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">corp_data1_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">corp_data1</span><span class="op">)</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">corp_data1_test</span><span class="op">)</span>
<span class="va">corp_data2_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">corp_data2</span><span class="op">)</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">corp_data2_test</span><span class="op">)</span>

<span class="va">corp_data1_test</span><span class="op">[</span>, <span class="va">id_1</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.N</span><span class="op">)</span><span class="op">]</span>
<span class="va">corp_data2_test</span><span class="op">[</span>, <span class="va">id_2</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.N</span><span class="op">)</span><span class="op">]</span>

<span class="va">corp_data2_test</span><span class="op">[</span>, <span class="va">Country</span> <span class="op">:=</span> <span class="va">country</span><span class="op">]</span>
<span class="va">corp_data2_test</span><span class="op">[</span>, <span class="va">Company</span> <span class="op">:=</span> <span class="va">Name</span><span class="op">]</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_plus.html">merge_plus</a></span><span class="op">(</span>
  data1 <span class="op">=</span> <span class="va">corp_data1_test</span>,
  data2 <span class="op">=</span> <span class="va">corp_data2_test</span>,
  match_type <span class="op">=</span> <span class="st">"multivar"</span>,
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Company"</span><span class="op">)</span>,
   suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_1"</span>, <span class="st">"_2"</span><span class="op">)</span>,
  unique_key_1 <span class="op">=</span> <span class="st">"id_1"</span>,
  unique_key_2 <span class="op">=</span> <span class="st">"id_2"</span>, 
  multivar_settings <span class="op">=</span> <span class="fu"><a href="../reference/build_multivar_settings.html">build_multivar_settings</a></span><span class="op">(</span>
  compare_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"indicator"</span>, <span class="st">"stringdist"</span><span class="op">)</span>,
  wgts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.5</span><span class="op">)</span>, nthread <span class="op">=</span> <span class="fl">1</span>
 
<span class="op">)</span><span class="op">)</span>
<span class="va">result</span>
<span class="co">#&gt; $matches</span>
<span class="co">#&gt;     unique_key_1          Company_1 Country_1 State  SIC Revenue id_1</span>
<span class="co">#&gt;  1:            1            Walmart       USA    OH 3300     485    1</span>
<span class="co">#&gt;  2:            2   Bershire Hataway       USA       2222     223    2</span>
<span class="co">#&gt;  3:            3              Apple       USA    CA 3384     215    3</span>
<span class="co">#&gt;  4:            4       Exxon Mobile       USA    TX 2222     205    4</span>
<span class="co">#&gt;  5:            5          McKesson    Germany    MA  222     192    5</span>
<span class="co">#&gt;  6:            6 UnitedHealth Group       USA    MA   NA     184    6</span>
<span class="co">#&gt;  7:            7         CVS Health       USA    RI 1112     177    7</span>
<span class="co">#&gt;  8:            9               AT&amp;T       USA    TN 4000     163    9</span>
<span class="co">#&gt;  9:            8     General Motors       USA    MI 2222     166    8</span>
<span class="co">#&gt; 10:           10 Ford Motor Company       USA    MI   NA     151   10</span>
<span class="co">#&gt;                   Name country state_code SIC_code earnings unique_key_2 id_2</span>
<span class="co">#&gt;  1:            Walmart     USA         OH     3380  490,000            1    1</span>
<span class="co">#&gt;  2:  Bershire Hathaway     USA         NE     2220  220,000            2    2</span>
<span class="co">#&gt;  3:     Apple Computer     USA         CA       NA  220,000            3    3</span>
<span class="co">#&gt;  4: Exxon Mobile Inc.      USA         TX     2222  210,000            4    4</span>
<span class="co">#&gt;  5:     McKesson Corp.                 MA     2222  190,000            5    5</span>
<span class="co">#&gt;  6: UnitedHealth Group     USA         MA     1130  180,000            6    6</span>
<span class="co">#&gt;  7: UnitedHealth Group     USA         MA     1130  180,000            6    6</span>
<span class="co">#&gt;  8:             AT &amp; T     USA         TN     4000  160,000            9    9</span>
<span class="co">#&gt;  9:         Ford Motor     USA         MI     2222  150,000           10   10</span>
<span class="co">#&gt; 10:         Ford Motor     USA         MI     2222  150,000           10   10</span>
<span class="co">#&gt;     Country_2          Company_2 Country_compare Company_compare multivar_score</span>
<span class="co">#&gt;  1:       USA            Walmart               1       1.0000000      1.0000000</span>
<span class="co">#&gt;  2:       USA  Bershire Hathaway               1       0.9882353      0.9941176</span>
<span class="co">#&gt;  3:       USA     Apple Computer               1       0.8714286      0.9357143</span>
<span class="co">#&gt;  4:       USA Exxon Mobile Inc.                1       0.9333333      0.9666667</span>
<span class="co">#&gt;  5:               McKesson Corp.               0       0.9285714      0.4642857</span>
<span class="co">#&gt;  6:       USA UnitedHealth Group               1       1.0000000      1.0000000</span>
<span class="co">#&gt;  7:       USA UnitedHealth Group               1       0.5333333      0.7666667</span>
<span class="co">#&gt;  8:       USA             AT &amp; T               1       0.9111111      0.9555556</span>
<span class="co">#&gt;  9:       USA         Ford Motor               1       0.7333333      0.8666667</span>
<span class="co">#&gt; 10:       USA         Ford Motor               1       0.9111111      0.9555556</span>
<span class="co">#&gt;     tier</span>
<span class="co">#&gt;  1:  all</span>
<span class="co">#&gt;  2:  all</span>
<span class="co">#&gt;  3:  all</span>
<span class="co">#&gt;  4:  all</span>
<span class="co">#&gt;  5:  all</span>
<span class="co">#&gt;  6:  all</span>
<span class="co">#&gt;  7:  all</span>
<span class="co">#&gt;  8:  all</span>
<span class="co">#&gt;  9:  all</span>
<span class="co">#&gt; 10:  all</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $matches_filter</span>
<span class="co">#&gt; Null data.table (0 rows and 0 cols)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data1_nomatch</span>
<span class="co">#&gt; Empty data.table (0 rows and 7 cols): Company,Country,State,SIC,Revenue,unique_key_1...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data2_nomatch</span>
<span class="co">#&gt;    Name country state_code SIC_code earnings unique_key_2 id_2 Country Company</span>
<span class="co">#&gt; 1:  CVS                 RI     1122  180,000            7    7             CVS</span>
<span class="co">#&gt; 2:   GM                 MI     2222  170,000            8    8              GM</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $match_evaluation</span>
<span class="co">#&gt;    tier matches in_tier_unique_1 in_tier_unique_2 pct_matched_1 pct_matched_2</span>
<span class="co">#&gt; 1:  all      10               10                8             1           0.8</span>
<span class="co">#&gt;    new_unique_1 new_unique_2</span>
<span class="co">#&gt; 1:           10            8</span></code></pre></div>
<p>Let’s go through the arguments:</p>
<ul>
<li>The first 7 arguments are identical to those in <code>merge_plus</code>, except ‘by’ can contain multiple elements, unlike with <code>merge_plus</code>.</li>
<li>‘compare_type’ is a character vector, equal to the length of the ‘by’ vector, that describes how to compare each field. The options are “in”, “indicator”, “difference”, “ratio”, and “stringdist”.
<ul>
<li>“indicator” is a binary indicator for if the two fields match exactly.</li>
<li>“in” is a binary indicator for one string being within the other (e.g. ‘abc corp’ and ‘abc’ would get a score of 1 )</li>
<li>“difference” computes the numeric difference between the two columns, scaled by the largest difference in the dataset</li>
<li>“ratio” computes the ratio between the two columns, always such that the ratio is less than 1</li>
<li>“stringdist” computes the Jaro-Winkler string distance between the strings.</li>
</ul>
</li>
<li>‘wgts’ is a vector of weights, length equal to the length of the ‘by’ vector, that describes how to weight each field for computing a multivar_score.</li>
<li>‘nthread’ is how many threads to use when making the comparisons, see <code><a href="https://rdrr.io/r/parallel/makeCluster.html">parallel::makeCluster()</a></code>
</li>
<li>‘logit’ is a logit model (described in detail later) that can be used instead of ‘wgts’ to combine the comparison scores into a final multivar_score using <code>base::predict()</code>
</li>
</ul>
</div>
<div id="return-value" class="section level1">
<h1 class="hasAnchor">
<a href="#return-value" class="anchor"></a>Return value</h1>
<p><code>multivar_match</code> returns a data.table with the columns from both <code>data_1</code> and <code>data_2</code>, just like <code><a href="https://rdrr.io/r/base/merge.html">base::merge()</a></code>. In addition, it returns three columns for each variable in <code>by</code>: two for the original columns in the data, and one column with the suffix ‘compare’ that has the numerical value for the given comparison. For example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">matches</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">Company_1</span>, <span class="va">Company_2</span>, <span class="va">Company_compare</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;              Company_1          Company_2 Company_compare</span>
<span class="co">#&gt;  1:            Walmart            Walmart       1.0000000</span>
<span class="co">#&gt;  2:   Bershire Hataway  Bershire Hathaway       0.9882353</span>
<span class="co">#&gt;  3:              Apple     Apple Computer       0.8714286</span>
<span class="co">#&gt;  4:       Exxon Mobile Exxon Mobile Inc.        0.9333333</span>
<span class="co">#&gt;  5:          McKesson      McKesson Corp.       0.9285714</span>
<span class="co">#&gt;  6: UnitedHealth Group UnitedHealth Group       1.0000000</span>
<span class="co">#&gt;  7:         CVS Health UnitedHealth Group       0.5333333</span>
<span class="co">#&gt;  8:               AT&amp;T             AT &amp; T       0.9111111</span>
<span class="co">#&gt;  9:     General Motors         Ford Motor       0.7333333</span>
<span class="co">#&gt; 10: Ford Motor Company         Ford Motor       0.9111111</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">matches</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">Country_1</span>, <span class="va">Country_2</span>, <span class="va">Country_compare</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;     Country_1 Country_2 Country_compare</span>
<span class="co">#&gt;  1:       USA       USA               1</span>
<span class="co">#&gt;  2:       USA       USA               1</span>
<span class="co">#&gt;  3:       USA       USA               1</span>
<span class="co">#&gt;  4:       USA       USA               1</span>
<span class="co">#&gt;  5:   Germany                         0</span>
<span class="co">#&gt;  6:       USA       USA               1</span>
<span class="co">#&gt;  7:       USA       USA               1</span>
<span class="co">#&gt;  8:       USA       USA               1</span>
<span class="co">#&gt;  9:       USA       USA               1</span>
<span class="co">#&gt; 10:       USA       USA               1</span></code></pre></div>
<p>Further, it adds one additional column for the overall multivar_score. In our example, we set the weights each equal to 0.5, so the multivar_score is simply the average of our two comparison variables:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">matches</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">Company_compare</span>, <span class="va">Country_compare</span>, <span class="va">multivar_score</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;     Company_compare Country_compare multivar_score</span>
<span class="co">#&gt;  1:       1.0000000               1      1.0000000</span>
<span class="co">#&gt;  2:       0.9882353               1      0.9941176</span>
<span class="co">#&gt;  3:       0.8714286               1      0.9357143</span>
<span class="co">#&gt;  4:       0.9333333               1      0.9666667</span>
<span class="co">#&gt;  5:       0.9285714               0      0.4642857</span>
<span class="co">#&gt;  6:       1.0000000               1      1.0000000</span>
<span class="co">#&gt;  7:       0.5333333               1      0.7666667</span>
<span class="co">#&gt;  8:       0.9111111               1      0.9555556</span>
<span class="co">#&gt;  9:       0.7333333               1      0.8666667</span>
<span class="co">#&gt; 10:       0.9111111               1      0.9555556</span></code></pre></div>
</div>
<div id="calculating-weights-from-a-training-set" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-weights-from-a-training-set" class="anchor"></a>Calculating weights from a training set</h1>
<p>If you’re not sure what the weights for each variable should be, you can use the function <code><a href="../reference/calculate_weights.html">fedmatch::calculate_weights()</a></code> in conjunction with a validated match set to get an estimate. This uses the methodology from Felligi and Sunter’s seminal paper <em>A Theory for Record Linkage</em>. You can find more information on the <a href="https://en.wikipedia.org/wiki/Record_linkage">Record Linkage Wikipedia page</a>. Essentially, fedmatch looks for which variables are most likely to match when two records match, and uses this criteria to weight the variables. Here is an example of how this would work:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span>
<span class="va">fake_result_table</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>
    Company_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ABC Corp"</span>, <span class="st">"XYZ Corporation"</span>, <span class="st">"Apple Corp"</span>, <span class="st">"Banana Corp"</span><span class="op">)</span>,
    Company_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ABC Corporation"</span>, <span class="st">"XYZ Inc"</span>, <span class="st">"Apple Incorporated"</span>, <span class="st">"Banana Stand"</span><span class="op">)</span>,
    Country_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"USA"</span>, <span class="st">"USA"</span>, <span class="st">"TUR"</span>, <span class="st">"USA"</span><span class="op">)</span>,
    Country_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MEX"</span>, <span class="st">"USA"</span>, <span class="st">"TUR"</span>, <span class="st">"USA"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">calculated_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_weights.html">calculate_weights</a></span><span class="op">(</span><span class="va">fake_result_table</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Company"</span>, <span class="st">"Country"</span><span class="op">)</span>,
                                        compare_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"stringdist"</span>, <span class="st">"indicator"</span><span class="op">)</span>,
                                        suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_1"</span>, <span class="st">"_2"</span><span class="op">)</span><span class="op">)</span>
<span class="va">calculated_weights</span><span class="op">$</span><span class="va">w</span>
<span class="co">#&gt;   Company   Country </span>
<span class="co">#&gt; 0.7349053 0.2650947</span></code></pre></div>
<p>In this dummy example, the names are giving us more information about the match quality than the countries, and so the weights are correspondingly higher. If you’d like more details on the exact methodology, see the manual documentation for <code>calculate_weights</code>.</p>
</div>
<div id="using-a-logit-model-instead-of-a-linear-sum" class="section level1">
<h1 class="hasAnchor">
<a href="#using-a-logit-model-instead-of-a-linear-sum" class="anchor"></a>Using a logit model instead of a linear sum</h1>
<p>Rather than using a linear combination of the comparison variables, we can instead train a logit model on a training set of matches and non-matches. The explanatory variables are each of the comparison variables, and the dependent variable is a binary 1/0 for if the two records are a match or not. This data set needs to be constructed by hand, and is similar to the type of data set used with <code>calculate_weights.</code> However, it must contain both matches and non-matches for the logit model to be well-trained. Here is an example of how this would look:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span>
<span class="va">corp_data1_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">corp_data1</span><span class="op">)</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">corp_data1_test</span><span class="op">)</span>
<span class="va">corp_data2_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">corp_data2</span><span class="op">)</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">corp_data2_test</span><span class="op">)</span>
<span class="va">corp_data1_test</span><span class="op">[</span>, <span class="va">id_1</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.N</span><span class="op">)</span><span class="op">]</span>
<span class="va">corp_data2_test</span><span class="op">[</span>, <span class="va">id_2</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.N</span><span class="op">)</span><span class="op">]</span>

<span class="va">corp_data2_test</span><span class="op">[</span>, <span class="va">Country</span> <span class="op">:=</span> <span class="va">country</span><span class="op">]</span>
<span class="va">corp_data2_test</span><span class="op">[</span>, <span class="va">Company</span> <span class="op">:=</span> <span class="va">Name</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span>
<span class="va">fake_result_table</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>
  match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">1e5</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
  Company_compare <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1e5</span><span class="op">)</span>,
  Country_compare <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fl">1e5</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">match</span> <span class="op">~</span> <span class="va">Company_compare</span> <span class="op">+</span> <span class="va">Country_compare</span>,
  family <span class="op">=</span> <span class="st">"binomial"</span>,
  data <span class="op">=</span> <span class="va">fake_result_table</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = match ~ Company_compare + Country_compare, family = "binomial", </span>
<span class="co">#&gt;     data = fake_result_table)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -1.4962  -1.4758   0.8941   0.9032   0.9109  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                 Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)      0.69243    0.01502  46.097   &lt;2e-16 ***</span>
<span class="co">#&gt; Company_compare -0.02710    0.02324  -1.166   0.2436    </span>
<span class="co">#&gt; Country_compare  0.03155    0.01342   2.351   0.0187 *  </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 127258  on 99999  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 127251  on 99997  degrees of freedom</span>
<span class="co">#&gt; AIC: 127257</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 4</span>

<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_plus.html">merge_plus</a></span><span class="op">(</span><span class="va">corp_data1_test</span>, <span class="va">corp_data2_test</span>,
                     match_type <span class="op">=</span> <span class="st">"multivar"</span>,
                     multivar_settings <span class="op">=</span> <span class="fu"><a href="../reference/build_multivar_settings.html">build_multivar_settings</a></span><span class="op">(</span>logit <span class="op">=</span> <span class="va">logit_model</span>, compare_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"indicator"</span>, <span class="st">"stringdist"</span><span class="op">)</span>,
  wgts <span class="op">=</span> <span class="cn">NULL</span>, nthread <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Company"</span><span class="op">)</span>, unique_key_1 <span class="op">=</span> <span class="st">"id_1"</span>,
  unique_key_2 <span class="op">=</span> <span class="st">"id_2"</span>, 
  suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_1"</span>, <span class="st">"_2"</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">result</span>
<span class="co">#&gt; $matches</span>
<span class="co">#&gt;     unique_key_1          Company_1 Country_1 State  SIC Revenue id_1</span>
<span class="co">#&gt;  1:            4       Exxon Mobile       USA    TX 2222     205    4</span>
<span class="co">#&gt;  2:            5          McKesson    Germany    MA  222     192    5</span>
<span class="co">#&gt;  3:            6 UnitedHealth Group       USA    MA   NA     184    6</span>
<span class="co">#&gt;  4:            9               AT&amp;T       USA    TN 4000     163    9</span>
<span class="co">#&gt;  5:            2   Bershire Hataway       USA       2222     223    2</span>
<span class="co">#&gt;  6:            7         CVS Health       USA    RI 1112     177    7</span>
<span class="co">#&gt;  7:           10 Ford Motor Company       USA    MI   NA     151   10</span>
<span class="co">#&gt;  8:            1            Walmart       USA    OH 3300     485    1</span>
<span class="co">#&gt;  9:            8     General Motors       USA    MI 2222     166    8</span>
<span class="co">#&gt; 10:            3              Apple       USA    CA 3384     215    3</span>
<span class="co">#&gt;                   Name country state_code SIC_code earnings unique_key_2 id_2</span>
<span class="co">#&gt;  1:            Walmart     USA         OH     3380  490,000            1    1</span>
<span class="co">#&gt;  2:            Walmart     USA         OH     3380  490,000            1    1</span>
<span class="co">#&gt;  3:            Walmart     USA         OH     3380  490,000            1    1</span>
<span class="co">#&gt;  4:            Walmart     USA         OH     3380  490,000            1    1</span>
<span class="co">#&gt;  5: Exxon Mobile Inc.      USA         TX     2222  210,000            4    4</span>
<span class="co">#&gt;  6: Exxon Mobile Inc.      USA         TX     2222  210,000            4    4</span>
<span class="co">#&gt;  7: UnitedHealth Group     USA         MA     1130  180,000            6    6</span>
<span class="co">#&gt;  8:             AT &amp; T     USA         TN     4000  160,000            9    9</span>
<span class="co">#&gt;  9:             AT &amp; T     USA         TN     4000  160,000            9    9</span>
<span class="co">#&gt; 10:         Ford Motor     USA         MI     2222  150,000           10   10</span>
<span class="co">#&gt;     Country_2          Company_2 Country_compare Company_compare multivar_score</span>
<span class="co">#&gt;  1:       USA            Walmart               1       0.0000000      0.6734819</span>
<span class="co">#&gt;  2:       USA            Walmart               0       0.0000000      0.6665064</span>
<span class="co">#&gt;  3:       USA            Walmart               1       0.3650794      0.6713026</span>
<span class="co">#&gt;  4:       USA            Walmart               1       0.0000000      0.6734819</span>
<span class="co">#&gt;  5:       USA Exxon Mobile Inc.                1       0.2847222      0.6717829</span>
<span class="co">#&gt;  6:       USA Exxon Mobile Inc.                1       0.3777778      0.6712266</span>
<span class="co">#&gt;  7:       USA UnitedHealth Group               1       0.4497354      0.6707962</span>
<span class="co">#&gt;  8:       USA             AT &amp; T               1       0.0000000      0.6734819</span>
<span class="co">#&gt;  9:       USA             AT &amp; T               1       0.4126984      0.6710178</span>
<span class="co">#&gt; 10:       USA         Ford Motor               1       0.0000000      0.6734819</span>
<span class="co">#&gt;     tier</span>
<span class="co">#&gt;  1:  all</span>
<span class="co">#&gt;  2:  all</span>
<span class="co">#&gt;  3:  all</span>
<span class="co">#&gt;  4:  all</span>
<span class="co">#&gt;  5:  all</span>
<span class="co">#&gt;  6:  all</span>
<span class="co">#&gt;  7:  all</span>
<span class="co">#&gt;  8:  all</span>
<span class="co">#&gt;  9:  all</span>
<span class="co">#&gt; 10:  all</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $matches_filter</span>
<span class="co">#&gt; Null data.table (0 rows and 0 cols)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data1_nomatch</span>
<span class="co">#&gt; Empty data.table (0 rows and 7 cols): Company,Country,State,SIC,Revenue,unique_key_1...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data2_nomatch</span>
<span class="co">#&gt;                 Name country state_code SIC_code earnings unique_key_2 id_2</span>
<span class="co">#&gt; 1: Bershire Hathaway     USA         NE     2220  220,000            2    2</span>
<span class="co">#&gt; 2:    Apple Computer     USA         CA       NA  220,000            3    3</span>
<span class="co">#&gt; 3:    McKesson Corp.                 MA     2222  190,000            5    5</span>
<span class="co">#&gt; 4:               CVS                 RI     1122  180,000            7    7</span>
<span class="co">#&gt; 5:                GM                 MI     2222  170,000            8    8</span>
<span class="co">#&gt;    Country           Company</span>
<span class="co">#&gt; 1:     USA Bershire Hathaway</span>
<span class="co">#&gt; 2:     USA    Apple Computer</span>
<span class="co">#&gt; 3:            McKesson Corp.</span>
<span class="co">#&gt; 4:                       CVS</span>
<span class="co">#&gt; 5:                        GM</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $match_evaluation</span>
<span class="co">#&gt;    tier matches in_tier_unique_1 in_tier_unique_2 pct_matched_1 pct_matched_2</span>
<span class="co">#&gt; 1:  all      10               10                5             1           0.5</span>
<span class="co">#&gt;    new_unique_1 new_unique_2</span>
<span class="co">#&gt; 1:           10            5</span></code></pre></div>
<p>Instead of using a weighted sum of comparison scores, we use <code>base::predict</code> to arrive at a multivar_score that can be interpreted as a match probability. A word of caution: the logit parameters can give very non-intuitive results for the resultant multivar_scores, because the <a href="https://en.wikipedia.org/wiki/Logit">logit function</a> is of course non-linear. For example, in one project we were working on, there was a coefficient of 40 and a coefficient of 3. However, if the variable with the coefficient of ‘3’ had a comparison score of 0, then the highest the multivar_score could be was only around 0.6! This was very unintuitive for us, and shows the complex nature of the logit model.</p>
<p>All that said, the logit model has the benefit of returning an easily-interpretable multivar_score: with a large enough (and clean enough) training set, the fitted multivar_score is simply the probability of a match. This is contrast to the multivar_scores returned by the linear combination: these numbers have no immediate meaning, and can vary dramatically for each project. In one project, a score of .6 might be very good, and in another, very bad. It is a good idea to try both the logit and linear methods and play around with each for your individual project.</p>
</div>
<div id="parallelization-and-saving-time" class="section level1">
<h1 class="hasAnchor">
<a href="#parallelization-and-saving-time" class="anchor"></a>Parallelization and saving time</h1>
<p>Because this method of matching relies on comparing each row of a data set to each other row of a dataset, the time needed to perform a match grows very quickly as the size of each data set increases. There are several ways to help with this:</p>
<ol style="list-style-type: decimal">
<li>Cut down on the number of comparisons that need to be done by grouping on one or more variables (say, countries) and only making comparisons within those groups, or</li>
<li>Use many cores to split the work up and run the comparisons in parallel.</li>
</ol>
<p>Here’s how the blocking works:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">corp_data1_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">corp_data1</span><span class="op">)</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">corp_data1_test</span><span class="op">)</span>
<span class="va">corp_data2_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">corp_data2</span><span class="op">)</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="va">corp_data2_test</span><span class="op">)</span>
<span class="va">corp_data1_test</span><span class="op">[</span>, <span class="va">id_1</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.N</span><span class="op">)</span><span class="op">]</span>
<span class="va">corp_data2_test</span><span class="op">[</span>, <span class="va">id_2</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">.N</span><span class="op">)</span><span class="op">]</span>

<span class="va">corp_data2_test</span><span class="op">[</span>, <span class="va">Country</span> <span class="op">:=</span> <span class="va">country</span><span class="op">]</span>
<span class="va">corp_data2_test</span><span class="op">[</span>, <span class="va">Company</span> <span class="op">:=</span> <span class="va">Name</span><span class="op">]</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_plus.html">merge_plus</a></span><span class="op">(</span>
  data1 <span class="op">=</span> <span class="va">corp_data1_test</span>,
  data2 <span class="op">=</span> <span class="va">corp_data2_test</span>,
  match_type <span class="op">=</span> <span class="st">"multivar"</span>,
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Company"</span><span class="op">)</span>,
   suffixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_1"</span>, <span class="st">"_2"</span><span class="op">)</span>,
  unique_key_1 <span class="op">=</span> <span class="st">"id_1"</span>,
  unique_key_2 <span class="op">=</span> <span class="st">"id_2"</span>, 
  multivar_settings <span class="op">=</span> <span class="fu"><a href="../reference/build_multivar_settings.html">build_multivar_settings</a></span><span class="op">(</span>
  compare_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="st">"stringdist"</span><span class="op">)</span>,
  wgts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, nthread <span class="op">=</span> <span class="fl">1</span>, blocks <span class="op">=</span> <span class="st">"Country"</span>
 
<span class="op">)</span><span class="op">)</span>
<span class="va">result</span><span class="op">$</span><span class="va">matches</span>
<span class="co">#&gt;    unique_key_1 Country          Company_1 State  SIC Revenue id_1</span>
<span class="co">#&gt; 1:            1     USA            Walmart    OH 3300     485    1</span>
<span class="co">#&gt; 2:            2     USA   Bershire Hataway       2222     223    2</span>
<span class="co">#&gt; 3:            3     USA              Apple    CA 3384     215    3</span>
<span class="co">#&gt; 4:            4     USA       Exxon Mobile    TX 2222     205    4</span>
<span class="co">#&gt; 5:            6     USA UnitedHealth Group    MA   NA     184    6</span>
<span class="co">#&gt; 6:            7     USA         CVS Health    RI 1112     177    7</span>
<span class="co">#&gt; 7:            9     USA               AT&amp;T    TN 4000     163    9</span>
<span class="co">#&gt; 8:            8     USA     General Motors    MI 2222     166    8</span>
<span class="co">#&gt; 9:           10     USA Ford Motor Company    MI   NA     151   10</span>
<span class="co">#&gt;                  Name country state_code SIC_code earnings unique_key_2 id_2</span>
<span class="co">#&gt; 1:            Walmart     USA         OH     3380  490,000            1    1</span>
<span class="co">#&gt; 2:  Bershire Hathaway     USA         NE     2220  220,000            2    2</span>
<span class="co">#&gt; 3:     Apple Computer     USA         CA       NA  220,000            3    3</span>
<span class="co">#&gt; 4: Exxon Mobile Inc.      USA         TX     2222  210,000            4    4</span>
<span class="co">#&gt; 5: UnitedHealth Group     USA         MA     1130  180,000            6    6</span>
<span class="co">#&gt; 6: UnitedHealth Group     USA         MA     1130  180,000            6    6</span>
<span class="co">#&gt; 7:             AT &amp; T     USA         TN     4000  160,000            9    9</span>
<span class="co">#&gt; 8:         Ford Motor     USA         MI     2222  150,000           10   10</span>
<span class="co">#&gt; 9:         Ford Motor     USA         MI     2222  150,000           10   10</span>
<span class="co">#&gt;             Company_2 Company_compare multivar_score tier</span>
<span class="co">#&gt; 1:            Walmart       1.0000000      1.0000000  all</span>
<span class="co">#&gt; 2:  Bershire Hathaway       0.9882353      0.9882353  all</span>
<span class="co">#&gt; 3:     Apple Computer       0.8714286      0.8714286  all</span>
<span class="co">#&gt; 4: Exxon Mobile Inc.        0.9333333      0.9333333  all</span>
<span class="co">#&gt; 5: UnitedHealth Group       1.0000000      1.0000000  all</span>
<span class="co">#&gt; 6: UnitedHealth Group       0.5333333      0.5333333  all</span>
<span class="co">#&gt; 7:             AT &amp; T       0.9111111      0.9111111  all</span>
<span class="co">#&gt; 8:         Ford Motor       0.7333333      0.7333333  all</span>
<span class="co">#&gt; 9:         Ford Motor       0.9111111      0.9111111  all</span></code></pre></div>
<p>For our dummy example data, this isn’t that useful (we just drop one observation with the Country being Germany). But, if there is a field in the data that is well-populated and trusted, it can be used to dramatically cut down on the number of observations.</p>
<p>Parallelization is implemented with the <code>nthread</code> argument and <code><a href="https://rdrr.io/r/parallel/clusterApply.html">parallel::parLapply()</a></code>. The data is split into groups equal to <code>nthread</code>, and then each core does its comparison, all at the same time. This of course can dramatically speed up the process, but requires more memory and computing power. For details on the parallel process, see <code><a href="https://rdrr.io/r/parallel/clusterApply.html">parallel::parLapply</a></code> and <code><a href="https://rdrr.io/r/parallel/makeCluster.html">parallel::makeCluster</a></code>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Melanie Friedrichs, Chris Webster, Blake Marsh, Jacob Dice, Seung Lee.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
